<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NET-METERING SIMULATOR for Electric Cooperatives</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            color: #1e293b;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }

        .input-group label {
            display: block;
            font-size: 0.65rem;
            font-weight: 800;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.35rem;
        }

        .input-group input {
            width: 100%;
            padding: 0.6rem 0.8rem;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.2s ease;
            background: #fdfdfd;
        }

        .input-group input:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        .tab-btn {
            padding: 0.6rem 1.2rem;
            font-weight: 700;
            font-size: 0.8rem;
            border-radius: 8px;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .tab-btn.active {
            background: #1e293b;
            color: white;
        }

        .meralco-table {
            width: 100%;
            border-collapse: collapse;
        }

        .meralco-table th {
            font-size: 0.65rem;
            font-weight: 900;
            color: #64748b;
            text-transform: uppercase;
            border-bottom: 2px solid #f1f5f9;
            padding: 0.75rem 0.5rem;
            text-align: right;
        }

        .meralco-table th:first-child {
            text-align: left;
        }

        .meralco-table td {
            font-size: 0.75rem;
            padding: 0.5rem;
            border-bottom: 1px solid #f8fafc;
            color: #475569;
            text-align: right;
        }

        .meralco-table td:first-child {
            text-align: left;
        }

        .section-header-row td {
            background-color: #f8fafc;
            font-weight: 800;
            color: #1e293b;
            font-size: 0.8rem;
        }

        .export-row-standard {
            background-color: #ecfdf5 !important;
            color: #065f46 !important;
            font-weight: 900 !important;
            border-left: 4px solid #10b981 !important;
        }

        .export-row-standard td {
            color: #065f46 !important;
            border-bottom-color: #d1fae5 !important;
        }

        .actual-kwh-highlight {
            background: #eff6ff;
            border-left: 4px solid #2563eb;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            border-radius: 0 12px 12px 0;
        }

        .badge-rejected {
            background: #fee2e2;
            color: #b91c1c;
            border: 1px solid #fecaca;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 800;
        }

        .permit-item {
            border-left: 2px solid #e2e8f0;
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }

        .advisory-box {
            background: #fffbeb;
            border: 1px solid #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .info-pill {
            font-size: 9px;
            font-weight: 800;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 4px;
        }

        .gov-sub-header {
            font-size: 11px;
            font-weight: 900;
            color: #1e293b;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            display: block;
            border-left: 3px solid #3b82f6;
            padding-left: 0.75rem;
        }

        .roadmap-step {
            position: relative;
            padding-left: 2.5rem;
            border-left: 2px solid #e2e8f0;
            padding-bottom: 2rem;
        }

        .roadmap-step:last-child {
            border-left-color: transparent;
            padding-bottom: 0;
        }

        .roadmap-step::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 0;
            height: 18px;
            width: 18px;
            background: white;
            border: 3px solid #3b82f6;
            border-radius: 9999px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 1rem;
        }

        .comp-col {
            @apply p-4 rounded-xl border border-slate-100 flex flex-col;
        }

        .comp-label {
            @apply text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1;
        }

        .comp-val {
            @apply text-base font-black text-slate-900;
        }

        .gov-card {
            @apply bg-white p-6 rounded-xl border border-slate-200 shadow-sm;
        }

        .gov-title {
            @apply text-lg font-black text-slate-800 uppercase tracking-tight mb-4 flex items-center gap-2;
        }

        .gov-text {
            @apply text-xs leading-relaxed text-slate-600 mb-4;
        }

        .gov-list {
            @apply list-none space-y-2 mt-4;
        }

        .gov-list li {
            @apply text-xs text-slate-600 flex items-start gap-2;
        }

        .gov-list li::before {
            content: '•';
            @apply text-blue-500 font-bold;
        }

        /* Styles for Editable Inputs in Table */
        .table-input {
            width: 100%;
            max-width: 80px;
            background: transparent;
            border-bottom: 1px dashed #cbd5e1;
            text-align: right;
            font-weight: 700;
            color: #475569;
            outline: none;
            padding: 2px 0;
            transition: all 0.2s;
        }

        .table-input:focus {
            border-bottom: 2px solid #2563eb;
            color: #1e293b;
        }

        .table-input.pct-input {
            max-width: 50px;
        }

        /* Print formatting */
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
            }

            .no-print {
                display: none !important;
            }

            .card {
                border: 1px solid #eee !important;
                box-shadow: none !important;
                margin-bottom: 20px !important;
                break-inside: avoid;
            }

            .max-w-7xl {
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 !important;
            }

            #tab-bill-content,
            #tab-analytics-content {
                display: block !important;
            }

            .lg\:col-span-3 {
                display: none !important;
            }

            .lg\:col-span-9,
            .lg\:col-span-12 {
                width: 100% !important;
            }

            .actual-kwh-highlight {
                border: 1px solid #blue-200 !important;
            }

            .meralco-table th,
            .meralco-table td {
                font-size: 10px !important;
            }

            .pricing-hero {
                font-size: 48px !important;
            }

            .table-input {
                border: none !important;
                text-align: right;
                padding: 0;
            }
        }
    </style>
</head>

<body class="p-4 lg:p-8" id="main-body">

    <div class="max-w-7xl mx-auto space-y-6">

        <!-- Header -->
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 no-print">
            <div>
                <h1 class="text-3xl font-black text-slate-900 tracking-tight italic uppercase">NET-METERING <span
                        class="not-italic text-slate-500 font-medium tracking-normal">SIMULATOR for Electric
                        Cooperatives</span></h1>
                <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-1">
                    Dec 2025 Schedule • Electric Cooperative Rate
                </p>
            </div>
            <div class="flex flex-wrap gap-2">
                <div class="flex bg-white p-1 rounded-xl shadow-sm border border-slate-200">
                    <button onclick="switchTab('bill')" id="btn-bill" class="tab-btn active">Itemized Bill</button>
                    <button onclick="switchTab('analytics')" id="btn-analytics" class="tab-btn text-slate-500">Analytics
                        & Comparison</button>
                </div>
                <!-- Print Button Removed -->
            </div>
        </div>

        <!-- TAB 1: BILLING SIMULATOR -->
        <div id="tab-bill-content" class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
            <div class="lg:col-span-3 space-y-4 no-print">
                <div class="card p-5 bg-slate-50/50">
                    <h2 class="text-[10px] font-black text-slate-900 mb-4 uppercase tracking-widest">Input Parameters
                    </h2>
                    <div class="space-y-3">
                        <div class="input-group">
                            <label>Solar PV Capacity (kWp)</label>
                            <input type="number" id="derCapacityKWp" value="5" max="100"
                                oninput="validateAndCalculate()">
                            <p class="text-[8px] text-red-500 font-bold mt-1 hidden" id="cap-warning">Max capacity is
                                100 kWp</p>
                        </div>
                        <div class="input-group">
                            <label>Solar Capacity Factor (%)</label>
                            <input type="number" id="capacityFactor" value="18" step="0.1" oninput="calculateBill()">
                        </div>
                        <div class="input-group">
                            <label>Grid Import (kWh)</label>
                            <input type="number" id="importKwh" value="329" oninput="calculateBill()">
                        </div>
                        <div class="input-group">
                            <label class="flex flex-col">
                                <span class="flex justify-between items-center">
                                    Solar Export (kWh)
                                </span>
                                <span class="text-[8px] text-slate-400 normal-case font-bold mt-1">Exported energy is
                                    credited at Generation Rate.</span>
                            </label>
                            <input type="number" id="exportKwh" value="731" oninput="calculateBill()">
                        </div>
                        <div class="input-group hidden">
                            <label>Billed Demand (kW)</label>
                            <input type="number" id="demandKw" value="0" oninput="calculateBill()">
                        </div>
                        <div class="input-group">
                            <label>Power Factor (%)</label>
                            <input type="number" id="powerFactor" value="98.84" step="0.01" oninput="calculateBill()">
                        </div>
                    </div>
                </div>

                <div id="sideStatusCard"
                    class="card p-5 bg-slate-900 text-white shadow-lg transition-colors duration-300">
                    <div class="flex justify-between items-start mb-1">
                        <p class="text-[10px] font-black uppercase opacity-60 tracking-widest">Amount Payable</p>
                        <span id="sideRejectionBadge" class="hidden badge-rejected uppercase">CAPPED</span>
                    </div>
                    <h2 class="text-3xl font-black tracking-tighter" id="sideTotal">₱ 0.00</h2>
                    <div id="rollover-box"
                        class="hidden mt-2 p-2 bg-emerald-900/50 border border-emerald-500/30 rounded text-emerald-400">
                        <p class="text-[8px] font-black uppercase">Rollover Credit</p>
                        <p class="text-sm font-black" id="sideRollover">₱ 0.00</p>
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/10">
                        <p class="text-[9px] font-bold uppercase opacity-60 text-emerald-400">REC Meter Mandatory</p>
                        <p class="text-[8px] font-bold uppercase opacity-50">No DSM Charges Applied</p>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-9 space-y-6">
                <!-- Actual Consumption Breakdown -->
                <div class="actual-kwh-highlight" id="actual-cons-box">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-xs font-black text-blue-900 uppercase tracking-widest">Monthly Energy Balance
                            (kWh)</h3>
                        <span
                            class="text-[9px] font-black bg-blue-600 text-white px-2 py-0.5 rounded uppercase tracking-tighter">Net-Metering
                            Summary</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center mb-4 text-center md:text-left">
                        <div class="bg-white p-3 rounded-lg border border-blue-100">
                            <p class="text-[9px] text-slate-400 font-black uppercase mb-1">Grid Import</p>
                            <p class="text-lg font-bold text-slate-800" id="math-import">97,800</p>
                        </div>
                        <div class="font-bold text-blue-400 italic text-center">minus</div>
                        <div class="bg-white p-3 rounded-lg border border-blue-100">
                            <p class="text-[9px] text-slate-400 font-black uppercase mb-1">Solar Export</p>
                            <p class="text-lg font-bold text-slate-800" id="math-export">5,000</p>
                        </div>
                        <div class="font-bold text-blue-400 md:hidden text-center">plus</div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center text-center md:text-left">
                        <div class="bg-white p-3 rounded-lg border border-blue-100">
                            <p class="text-[9px] text-slate-400 font-black uppercase mb-1">Solar Generated</p>
                            <p class="text-lg font-bold text-slate-800" id="math-gen">60,264</p>
                        </div>
                        <div class="font-bold text-blue-400 italic text-center">equals</div>
                        <div class="bg-blue-600 p-3 rounded-lg col-span-1 md:col-span-2 shadow-sm">
                            <p class="text-[9px] text-blue-100 font-black uppercase mb-1">Total Billing Base (Subsidies
                                Multiplier)</p>
                            <p class="text-xl font-black text-white" id="math-actual">153,064 kWh</p>
                        </div>
                    </div>
                </div>

                <div class="card overflow-hidden">
                    <div class="bg-slate-50 border-b border-slate-100 p-8 flex justify-between items-center">
                        <h2 class="text-base font-black text-slate-800 uppercase tracking-tight">Statement Details</h2>
                        <div class="flex items-center gap-6">
                            <div class="text-right">
                                <p
                                    class="text-[8px] font-black text-slate-400 uppercase tracking-widest mb-1 text-right">
                                    Net billing Base</p>
                                <span class="text-6xl font-black text-slate-900 italic block pricing-hero"
                                    id="tierDisp">NM</span>
                            </div>
                        </div>
                    </div>

                    <div class="p-2 overflow-x-auto">
                        <table class="meralco-table">
                            <thead>
                                <tr>
                                    <th class="text-left">Description</th>
                                    <th>Base</th>
                                    <th>Price (Editable)</th>
                                    <th>Amount (PhP)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Generation & Transmission -->
                                <tr class="section-header-row">
                                    <td colspan="3">Generation & Transmission</td>
                                    <td id="det-gen-trans-total">0.00</td>
                                </tr>
                                <tr>
                                    <td>Generation System Charge</td>
                                    <td id="li-gen-base">--</td>
                                    <td><input type="number" id="rate-gen" value="5.8118" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-gen-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Benefits to Host Communities</td>
                                    <td id="li-host-base">--</td>
                                    <td><input type="number" id="rate-host" value="0.0282" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-host-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Power Act Reduction</td>
                                    <td id="li-power-base">--</td>
                                    <td><input type="number" id="rate-poweract" value="-0.1052" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-power-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Transmission Demand Charge</td>
                                    <td id="li-trans-demand-base">--</td>
                                    <td><input type="number" id="rate-trans-demand" value="0.0000" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-trans-demand-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Transmission System Charge</td>
                                    <td id="li-trans-base">--</td>
                                    <td><input type="number" id="rate-trans" value="1.3561" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-trans-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>System Loss Charge</td>
                                    <td id="li-sl-base">--</td>
                                    <td><input type="number" id="rate-sl" value="0.7319" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-sl-amt">0.00</td>
                                </tr>

                                <!-- Distribution -->
                                <tr class="section-header-row">
                                    <td colspan="3">Distribution</td>
                                    <td id="det-dist-total">0.00</td>
                                </tr>
                                <tr>
                                    <td>Distribution System Charge</td>
                                    <td id="li-dist-energy-base">--</td>
                                    <td><input type="number" id="rate-dist-energy" value="0.4613" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-dist-energy-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Distribution Demand Charge</td>
                                    <td id="li-dist-demand-base">--</td>
                                    <td><input type="number" id="rate-dist-demand" value="0.0000" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-dist-demand-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Supply System Charge</td>
                                    <td id="li-supply-base">--</td>
                                    <td><input type="number" id="rate-supply" value="0.5376" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-supply-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Supply Retail Customer Charge</td>
                                    <td>1.00 mo</td>
                                    <td><input type="number" id="rate-supply-fix" value="0.0000" step="0.01"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="disp-supply-fix">0.00</td>
                                </tr>
                                <tr>
                                    <td>Metering System Charge</td>
                                    <td id="li-metering-base">--</td>
                                    <td><input type="number" id="rate-metering" value="0.3205" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-metering-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Metering Retail Customer Charge</td>
                                    <td>1.00 mo</td>
                                    <td><input type="number" id="rate-metering-fix" value="5.0000" step="0.01"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="disp-metering-fix">5.00</td>
                                </tr>
                                <tr>
                                    <td>Reinvestment Fund for Sustainable CapEx</td>
                                    <td id="li-reinvest-base">--</td>
                                    <td><input type="number" id="rate-reinvest" value="0.2178" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-reinvest-amt">0.00</td>
                                </tr>

                                <!-- Subsidy & Discount -->
                                <tr class="section-header-row">
                                    <td colspan="3">Subsidy & Discount</td>
                                    <td id="det-subs-total">0.00</td>
                                </tr>
                                <tr>
                                    <td>Lifeline Rate Subsidy/Discount</td>
                                    <td id="li-life-base">--</td>
                                    <td><input type="number" id="rate-life" value="0.0036" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-life-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Senior Citizen Subsidy/Discount</td>
                                    <td id="li-senior-base">--</td>
                                    <td><input type="number" id="rate-senior" value="0.0005" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-senior-amt">0.00</td>
                                </tr>

                                <!-- Local Taxes -->
                                <tr class="section-header-row">
                                    <td colspan="3">Local Taxes</td>
                                    <td id="det-tax-total">0.00</td>
                                </tr>
                                <tr>
                                    <td>Local Franchise Tax Energy Charge</td>
                                    <td id="li-lft-energy-base">--</td>
                                    <td><input type="number" id="rate-lft-energy" value="0.0000" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-lft-energy-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Local Franchise Tax Demand Charge</td>
                                    <td id="li-lft-demand-base">--</td>
                                    <td><input type="number" id="rate-lft-demand" value="0.0000" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-lft-demand-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Local Franchise Tax Fixed Monthly Charge</td>
                                    <td>1.00 mo</td>
                                    <td><input type="number" id="rate-lft-fix" value="0.0000" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-lft-fix-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Business Tax</td>
                                    <td id="li-bus-tax-base">--</td>
                                    <td><input type="number" id="rate-bus-tax" value="0.0000" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-bus-tax-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Real Property Tax</td>
                                    <td id="li-rpt-base">--</td>
                                    <td><input type="number" id="rate-rpt" value="0.0066" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-rpt-amt">0.00</td>
                                </tr>

                                <!-- Value Added Tax -->
                                <tr class="section-header-row">
                                    <td colspan="3">Value Added Tax</td>
                                    <td id="det-vat-total">0.00</td>
                                </tr>
                                <tr>
                                    <td>Generation VAT</td>
                                    <td id="li-gen-vat-base">--</td>
                                    <td><input type="number" id="rate-gen-vat" value="0.3595" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-gen-vat-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Transmission VAT</td>
                                    <td id="li-trans-vat-base">--</td>
                                    <td><input type="number" id="rate-trans-vat" value="0.1580" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-trans-vat-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>System Loss VAT</td>
                                    <td id="li-sl-vat-base">--</td>
                                    <td><input type="number" id="rate-sl-vat" value="0.0512" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-sl-vat-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Distribution VAT (Energy)</td>
                                    <td id="li-dist-vat-kwh-base">--</td>
                                    <td><input type="number" id="rate-dist-vat-kwh" value="0.1457" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-dist-vat-kwh-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Distribution VAT (Fixed)</td>
                                    <td>1.00 mo</td>
                                    <td><input type="number" id="rate-dist-vat-fix" value="0.6000" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-dist-vat-fix-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Subsidy VAT (Lifeline & Senior Citizen)</td>
                                    <td id="li-subs-vat-base">--</td>
                                    <td><input type="number" id="rate-subs-vat" value="0.0005" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-subs-vat-amt">0.00</td>
                                </tr>

                                <!-- Universal Charges -->
                                <tr class="section-header-row">
                                    <td colspan="3">Universal Charges</td>
                                    <td id="det-uc-total">0.00</td>
                                </tr>
                                <tr>
                                    <td>NPC Stranded Debts</td>
                                    <td id="li-uc-sd-base">--</td>
                                    <td><input type="number" id="rate-uc-sd" value="0.0428" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-uc-sd-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Missionary Electrification Charge - SPUG</td>
                                    <td id="li-uc-spug-base">--</td>
                                    <td><input type="number" id="rate-uc-spug" value="0.1949" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-uc-spug-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Missionary Electrification Charge - REDCI</td>
                                    <td id="li-uc-redci-base">--</td>
                                    <td><input type="number" id="rate-uc-redci" value="0.0044" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-uc-redci-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>Environmental Share/Charge</td>
                                    <td id="li-uc-env-base">--</td>
                                    <td><input type="number" id="rate-uc-env" value="0.0025" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-uc-env-amt">0.00</td>
                                </tr>
                                <tr>
                                    <td>FIT - All (Renewable)</td>
                                    <td id="li-fit-base">--</td>
                                    <td><input type="number" id="rate-fit" value="0.2073" step="0.0001"
                                            class="table-input" oninput="calculateBill()"></td>
                                    <td id="li-fit-amt">0.00</td>
                                </tr>

                                <!-- Others -->
                                <tr class="section-header-row">
                                    <td colspan="3">Others</td>
                                    <td id="det-others-total">0.00</td>
                                </tr>

                                <!-- Exported Energy -->
                                <tr id="li-export-row" class="export-row-standard transition-all duration-300">
                                    <td id="li-export-label" class="uppercase tracking-widest py-4 font-black">
                                        Net-Metering Credits</td>
                                    <td id="li-export-base" class="py-4 font-bold">--</td>
                                    <td id="li-export-price" class="py-4 font-bold">--</td>
                                    <td id="det-der-credit" class="py-4 font-black text-emerald-800 text-lg">- 0.00</td>
                                </tr>
                                <tr id="li-excess-row"
                                    class="hidden text-[10px] text-rose-600 font-bold bg-rose-50 border-t border-rose-100">
                                    <td class="py-2">Surplus Export Volume (Beyond 30% Cap - Not Paid)</td>
                                    <td id="li-excess-base" class="py-2">--</td>
                                    <td class="py-2">0.0000</td>
                                    <td class="py-2">0.00</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div
                        class="bg-slate-900 p-8 text-white grid grid-cols-1 md:grid-cols-2 gap-8 border-t border-white/10">
                        <div class="space-y-1 opacity-80">
                            <div class="flex justify-between text-[10px] font-black uppercase"><span>Gross Energy
                                    Amount:</span> <span id="footer-gross">0.00</span></div>
                            <div class="flex justify-between text-[10px] font-black uppercase text-emerald-400">
                                <span>Applied Export Credit:</span> <span id="footer-export">- 0.00</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Final Net
                                Amount Payable</p>
                            <p class="text-5xl font-black tracking-tighter text-white" id="footer-total">₱ 0.00</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: ANALYTICS & COMPARISON -->
        <div id="tab-analytics-content" class="hidden space-y-6">
            <!-- ROI PANEL -->
            <div class="card p-8 border-t-4 border-blue-600">
                <div class="flex flex-col md:flex-row justify-between gap-8">
                    <div class="md:w-1/3 space-y-6">
                        <h3 class="text-xl font-black text-slate-900 uppercase tracking-tight flex items-center gap-2">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                </path>
                            </svg>
                            ROI Calculator
                        </h3>
                        <div class="space-y-4">
                            <div class="input-group">
                                <label>Investment per kWp (PhP)</label>
                                <input type="number" id="roi-cost-kw" value="30000" oninput="calculateBill()"
                                    class="input-premium">
                            </div>
                            <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                                <p class="text-[10px] font-black text-slate-400 uppercase">Total Estimated CAPEX</p>
                                <p class="text-xl font-black text-slate-900" id="roi-total-capex">₱ 0.00</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div
                            class="p-6 bg-blue-600 text-white rounded-3xl shadow-xl shadow-blue-100 flex flex-col justify-center">
                            <p class="text-[10px] font-black uppercase opacity-60 mb-2">Monthly Cash Flow Benefit</p>
                            <p class="text-4xl font-black" id="roi-monthly-savings">₱ 0.00</p>
                            <p class="text-[10px] mt-4 opacity-80 font-medium">Monthly Savings vs Traditional Grid
                                Billing.</p>
                        </div>
                        <div
                            class="p-6 bg-emerald-50 border border-emerald-100 rounded-3xl flex flex-col justify-center text-center">
                            <p class="text-[10px] font-black text-emerald-600 uppercase mb-2 tracking-[0.2em]">Simple
                                Payback Period</p>
                            <p class="text-5xl font-black text-emerald-900"><span id="roi-payback-val">0.0</span> <span
                                    class="text-sm font-bold uppercase text-emerald-600">Years</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COMPARISON PANEL -->
            <div class="card p-8 border-t-4 border-slate-900">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-xl font-black text-slate-900 uppercase tracking-tight">Scenario Comparison Dashboard
                    </h3>
                    <div class="bg-slate-50 p-2 rounded-xl border border-slate-100 flex items-center gap-3">
                        <label class="text-[10px] font-black text-slate-400 uppercase">Fixed Monthly Fee
                            (Developer):</label>
                        <input type="number" id="ppa-rate" value="5000" step="100" oninput="calculateBill()"
                            class="w-20 px-2 py-1 bg-white border border-blue-200 rounded text-xs font-bold text-blue-900 outline-none">
                        <span class="text-[10px] font-bold text-slate-400">PHP/mo</span>
                    </div>
                </div>

                <div id="ranking-summary" class="mb-8 p-6 bg-slate-900 rounded-3xl text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-8 opacity-10">
                        <svg class="w-24 h-24 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z">
                            </path>
                        </svg>
                    </div>
                    <div class="flex flex-col md:flex-row md:items-center gap-6 relative z-10">
                        <div class="p-4 bg-emerald-500 rounded-2xl shadow-xl shadow-emerald-500/20 w-fit">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                    d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <div>
                            <h4 class="text-xs font-black uppercase tracking-[0.3em] text-emerald-400 mb-2">Expert Smart
                                Analysis</h4>
                            <p id="best-scenario-text" class="text-lg font-black tracking-tight leading-tight">Analyzing
                                market rates and your consumption profile...</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Scenario 1: Traditional -->
                    <div class="p-6 rounded-3xl border border-slate-100 bg-white relative overflow-hidden group">
                        <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                            <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20">
                                <path
                                    d="M10 2a8 8 0 100 16 8 8 0 000-16zM5 9a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z">
                                </path>
                            </svg>
                        </div>
                        <div id="rank-badge-a"
                            class="absolute top-4 left-4 px-3 py-1 bg-slate-100 text-[10px] font-black rounded-full uppercase tracking-widest z-10 border border-slate-200">
                            RANK #--</div>
                        <p class="text-[10px] font-black text-slate-400 uppercase mb-4 tracking-widest">A. Traditional
                            Grid</p>
                        <p class="text-4xl font-black text-slate-900 mb-6" id="comp-trad">₱ 0.00</p>
                        <div class="space-y-3 pt-6 border-t border-slate-50">
                            <div class="flex justify-between text-[11px] font-bold">
                                <span class="text-slate-400 uppercase">Utility Pymt</span>
                                <span class="text-slate-700" id="comp-trad-util">₱ 0.00</span>
                            </div>
                            <div class="flex justify-between text-[11px] font-bold">
                                <span class="text-slate-400 uppercase">Solar Pymt</span>
                                <span class="text-slate-300">N/A</span>
                            </div>
                        </div>
                    </div>

                    <!-- Scenario 2: DER Exporting -->
                    <div
                        class="p-6 rounded-3xl border border-emerald-100 bg-emerald-50/50 relative overflow-hidden shadow-lg shadow-emerald-50 ring-2 ring-emerald-500 ring-offset-2">
                        <div class="absolute top-0 right-0 p-4 opacity-10">
                            <svg class="w-12 h-12 text-emerald-600" fill="currentColor" viewBox="0 0 20 20">
                                <path
                                    d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM5.884 6.607a1 1 0 011.414 0l.707.707a1 1 0 11-1.414 1.414l-.707-.707a1 1 0 010-1.414zm9.9 0a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM3 11a1 1 0 100-2H2a1 1 0 100 2h1zm15 0a1 1 0 100-2h-1a1 1 0 100 2h1zM5.05 15.05a1 1 0 011.414 0l.707.707a1 1 0 01-1.414 1.414l-.707-.707a1 1 0 010-1.414zm9.9 0a1 1 0 010 1.414l-.707.707a1 1 0-1.414-1.414l.707-.707a1 1 0 010 1.414zM10 11a1 1 0 100-2 1 1 0 000 2z">
                                </path>
                            </svg>
                        </div>
                        <div id="rank-badge-b"
                            class="absolute top-4 left-4 px-3 py-1 bg-emerald-500 text-white text-[10px] font-black rounded-full uppercase tracking-widest z-10">
                            RANK #--</div>
                        <p class="text-[10px] font-black text-emerald-600 uppercase mb-4 tracking-widest">B.
                            Net-Metering System (Current)</p>
                        <p class="text-4xl font-black text-emerald-900 mb-6" id="comp-der-exp">₱ 0.00</p>
                        <div class="space-y-3 pt-6 border-t border-emerald-100">
                            <div class="flex justify-between text-[11px] font-bold">
                                <span class="text-emerald-600 uppercase opacity-60">Utility Pymt</span>
                                <span class="text-emerald-900" id="comp-der-exp-util">₱ 0.00</span>
                            </div>
                            <div class="flex justify-between text-[11px] font-bold">
                                <span class="text-emerald-600 uppercase opacity-60">Solar Pymt</span>
                                <span class="text-emerald-900">₱ 0.00 (Self-Owned)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Scenario 3: DER Non-Exporting PPA -->
                    <div class="p-6 rounded-3xl border border-blue-100 bg-blue-50/50 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10">
                            <svg class="w-12 h-12 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6h10v6H6v-6z"
                                    clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div id="rank-badge-c"
                            class="absolute top-4 left-4 px-3 py-1 bg-blue-500 text-white text-[10px] font-black rounded-full uppercase tracking-widest z-10">
                            RANK #--</div>
                        <p class="text-[10px] font-black text-blue-600 uppercase mb-4 tracking-widest">C. Non-Exporting
                            (PPA)</p>
                        <p class="text-4xl font-black text-blue-900 mb-6" id="comp-der-ppa">₱ 0.00</p>
                        <div class="space-y-3 pt-6 border-t border-blue-100">
                            <div class="flex justify-between text-[11px] font-bold">
                                <span class="text-blue-600 uppercase opacity-60">Utility Pymt</span>
                                <span class="text-blue-900" id="comp-der-ppa-util">₱ 0.00</span>
                            </div>
                            <div class="flex justify-between text-[11px] font-bold">
                                <span class="text-blue-600 uppercase opacity-60">Developer Pymt</span>
                                <span class="text-blue-900 font-black" id="comp-der-ppa-contract">₱ 0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <script>
        const formatNumber = (num) => num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const setUI = (id, text) => { const el = document.getElementById(id); if (el) el.innerText = text; };

        function switchTab(view) {
            const bill = document.getElementById('tab-bill-content');
            const flow = document.getElementById('tab-flow-content');
            const analytics = document.getElementById('tab-analytics-content');
            const buttons = {
                'bill': document.getElementById('btn-bill'),
                'analytics': document.getElementById('btn-analytics')
            };

            if (bill) bill.classList.toggle('hidden', view !== 'bill');
            if (flow) flow.classList.add('hidden'); // Removed tab
            if (analytics) analytics.classList.toggle('hidden', view !== 'analytics');

            Object.keys(buttons).forEach(key => {
                if (buttons[key]) {
                    buttons[key].className = (key === view) ? "tab-btn active" : "tab-btn text-slate-500";
                }
            });
        }

        function validateAndCalculate() {
            const el = document.getElementById('derCapacityKWp');
            const warn = document.getElementById('cap-warning');

            if (parseFloat(el.value) > 100) {
                el.value = 100;
                el.classList.add('border-red-500', 'text-red-600');
                if (warn) warn.classList.remove('hidden');
            } else {
                el.classList.remove('border-red-500', 'text-red-600');
                if (warn) warn.classList.add('hidden');
            }
            calculateBill();
        }

        function calculateBill() {
            // Helper to get rate from input
            const getR = (id) => parseFloat(document.getElementById(id).value) || 0;

            // Updated Rates (Fetched from UI inputs)
            const rates = {
                gen: getR('rate-gen'),
                host: getR('rate-host'),
                poweract: getR('rate-poweract'),
                transDemand: getR('rate-trans-demand'),
                trans: getR('rate-trans'),
                sl: getR('rate-sl'),
                distEnergy: getR('rate-dist-energy'),
                distDemand: getR('rate-dist-demand'),
                supply: getR('rate-supply'),
                supplyFix: getR('rate-supply-fix'),
                metering: getR('rate-metering'),
                meteringFix: getR('rate-metering-fix'),
                reinvest: getR('rate-reinvest'),
                life: getR('rate-life'),
                senior: getR('rate-senior'),
                lftEnergy: getR('rate-lft-energy'),
                lftDemand: getR('rate-lft-demand'),
                lftFix: getR('rate-lft-fix'),
                busTax: getR('rate-bus-tax'),
                rpt: getR('rate-rpt'),
                genVat: getR('rate-gen-vat'),
                transVat: getR('rate-trans-vat'),
                slVat: getR('rate-sl-vat'),
                distVatKwh: getR('rate-dist-vat-kwh'),
                distVatFix: getR('rate-dist-vat-fix'),
                subsVat: getR('rate-subs-vat'),
                ucSd: getR('rate-uc-sd'),
                ucSpug: getR('rate-uc-spug'),
                ucRedci: getR('rate-uc-redci'),
                ucEnv: getR('rate-uc-env'),
                fit: getR('rate-fit')
            };

            // Update display for fixed charges
            setUI('disp-supply-fix', formatNumber(rates.supplyFix));
            setUI('disp-metering-fix', formatNumber(rates.meteringFix));

            const derKWp = parseFloat(document.getElementById('derCapacityKWp').value) || 0;
            const cf = parseFloat(document.getElementById('capacityFactor').value) || 0;
            const importKwh = parseFloat(document.getElementById('importKwh').value) || 0;
            const exportKwh = parseFloat(document.getElementById('exportKwh').value) || 0;
            const demandKw = parseFloat(document.getElementById('demandKw').value) || 0;
            const ppaRate = parseFloat(document.getElementById('ppa-rate').value) || 0;

            const solarGen = derKWp * 24 * 30 * (cf / 100);
            const actualConsumption = importKwh - exportKwh + solarGen;

            // 1. Generation & Transmission
            const genAmt = importKwh * rates.gen;
            const hostAmt = importKwh * rates.host;
            const powerAmt = importKwh * rates.poweract;
            const transDemandAmt = demandKw * rates.transDemand;
            const transSystemAmt = importKwh * rates.trans;
            const slAmt = importKwh * rates.sl;
            const genTransSubtotal = genAmt + hostAmt + powerAmt + transDemandAmt + transSystemAmt + slAmt;

            // 2. Distribution
            const distEnergyAmt = importKwh * rates.distEnergy;
            const distDemandAmt = demandKw * rates.distDemand;
            const supplySystemAmt = importKwh * rates.supply;
            const supplyFixAmt = rates.supplyFix;
            const meteringSystemAmt = importKwh * rates.metering;
            const meteringFixAmt = rates.meteringFix;
            const reinvestAmt = importKwh * rates.reinvest;
            const distSubtotal = distEnergyAmt + distDemandAmt + supplySystemAmt + supplyFixAmt + meteringSystemAmt + meteringFixAmt + reinvestAmt;

            // 3. Subsidy & Discount
            const lifeAmt = actualConsumption * rates.life;
            const seniorAmt = actualConsumption * rates.senior;
            const subsSubtotal = lifeAmt + seniorAmt;

            // 4. Local Taxes
            const lftEnergyAmt = importKwh * rates.lftEnergy;
            const lftDemandAmt = demandKw * rates.lftDemand;
            const lftFixAmt = rates.lftFix;
            const busTaxAmt = importKwh * rates.busTax;
            const rptAmt = importKwh * rates.rpt;
            const taxSubtotal = lftEnergyAmt + lftDemandAmt + lftFixAmt + busTaxAmt + rptAmt;

            // 5. Value Added Tax
            const genVatAmt = importKwh * rates.genVat;
            const transVatAmt = importKwh * rates.transVat;
            const slVatAmt = importKwh * rates.slVat;
            const distVatEnergyAmt = importKwh * rates.distVatKwh;
            const distVatFixAmt = rates.distVatFix;
            const distVatAmt = distVatEnergyAmt + distVatFixAmt;
            const subsVatAmt = actualConsumption * rates.subsVat;
            const vatSubtotal = genVatAmt + transVatAmt + slVatAmt + distVatAmt + subsVatAmt;

            // 6. Universal Charges
            const ucSdAmt = importKwh * rates.ucSd;
            const ucSpugAmt = importKwh * rates.ucSpug;
            const ucRedciAmt = importKwh * rates.ucRedci;
            const ucEnvAmt = importKwh * rates.ucEnv;
            const fitAmt = actualConsumption * rates.fit;
            const ucSubtotal = ucSdAmt + ucSpugAmt + ucRedciAmt + ucEnvAmt + fitAmt;

            const grossTotal = genTransSubtotal + distSubtotal + subsSubtotal + taxSubtotal + vatSubtotal + ucSubtotal;

            const exportPrice = rates.gen + rates.host;
            const derCredit = exportKwh * exportPrice;
            const netAmount = grossTotal - derCredit;

            // Scenario 1: Traditional (No Solar)
            const tradVolume = solarGen - exportKwh + importKwh;
            const tradGenTrans = tradVolume * (rates.gen + rates.host + rates.poweract + rates.trans + rates.sl) + (demandKw * rates.transDemand);
            const tradDist = (tradVolume * (rates.distEnergy + rates.supply + rates.metering + rates.reinvest)) + (demandKw * rates.distDemand) + rates.supplyFix + rates.meteringFix;
            const tradSubs = actualConsumption * (rates.life + rates.senior);
            const tradTax = (tradVolume * (rates.lftEnergy + rates.busTax + rates.rpt)) + (demandKw * rates.lftDemand) + rates.lftFix;
            const tradVat = (tradVolume * (rates.genVat + rates.transVat + rates.slVat + rates.distVatKwh)) + rates.distVatFix + (actualConsumption * rates.subsVat);
            const tradUc = (tradVolume * (rates.ucSd + rates.ucSpug + rates.ucRedci + rates.ucEnv)) + (actualConsumption * rates.fit);
            const traditionalTotal = tradGenTrans + tradDist + tradSubs + tradTax + tradVat + tradUc;

            // UI Updates
            setUI('math-import', importKwh.toLocaleString());
            setUI('math-export', exportKwh.toLocaleString());
            setUI('math-gen', Math.round(solarGen).toLocaleString());
            setUI('math-actual', Math.round(actualConsumption).toLocaleString() + " kWh (Gross)");

            let payableAmount = netAmount;
            let rolloverCredit = 0;
            if (netAmount < 0) {
                payableAmount = 0;
                rolloverCredit = Math.abs(netAmount);
            }

            setUI('sideTotal', "₱ " + formatNumber(payableAmount));
            if (rolloverCredit > 0) {
                document.getElementById('rollover-box').classList.remove('hidden');
                setUI('sideRollover', "₱ " + formatNumber(rolloverCredit));
            } else {
                document.getElementById('rollover-box').classList.add('hidden');
            }
            setUI('tierDisp', "NM");

            // Detailed Table Updates
            setUI('det-gen-trans-total', formatNumber(genTransSubtotal));
            setUI('li-gen-base', importKwh.toLocaleString() + " kWh"); setUI('li-gen-amt', formatNumber(genAmt));
            setUI('li-host-base', importKwh.toLocaleString() + " kWh"); setUI('li-host-amt', formatNumber(hostAmt));
            setUI('li-power-base', importKwh.toLocaleString() + " kWh"); setUI('li-power-amt', formatNumber(powerAmt));
            setUI('li-trans-demand-base', demandKw.toLocaleString() + " kW"); setUI('li-trans-demand-amt', formatNumber(transDemandAmt));
            setUI('li-trans-base', importKwh.toLocaleString() + " kWh"); setUI('li-trans-amt', formatNumber(transSystemAmt));
            setUI('li-sl-base', importKwh.toLocaleString() + " kWh"); setUI('li-sl-amt', formatNumber(slAmt));

            setUI('det-dist-total', formatNumber(distSubtotal));
            setUI('li-dist-energy-base', importKwh.toLocaleString() + " kWh"); setUI('li-dist-energy-amt', formatNumber(distEnergyAmt));
            setUI('li-dist-demand-base', demandKw.toLocaleString() + " kW"); setUI('li-dist-demand-amt', formatNumber(distDemandAmt));
            setUI('li-supply-base', importKwh.toLocaleString() + " kWh"); setUI('li-supply-amt', formatNumber(supplySystemAmt));
            setUI('li-metering-base', importKwh.toLocaleString() + " kWh"); setUI('li-metering-amt', formatNumber(meteringSystemAmt));
            setUI('li-reinvest-base', importKwh.toLocaleString() + " kWh"); setUI('li-reinvest-amt', formatNumber(reinvestAmt));

            setUI('det-subs-total', formatNumber(subsSubtotal));
            setUI('li-life-base', Math.round(actualConsumption).toLocaleString() + " kWh"); setUI('li-life-amt', formatNumber(lifeAmt));
            setUI('li-senior-base', Math.round(actualConsumption).toLocaleString() + " kWh"); setUI('li-senior-amt', formatNumber(seniorAmt));

            setUI('det-tax-total', formatNumber(taxSubtotal));
            setUI('li-lft-energy-base', importKwh.toLocaleString() + " kWh"); setUI('li-lft-energy-amt', formatNumber(lftEnergyAmt));
            setUI('li-lft-demand-base', demandKw.toLocaleString() + " kW"); setUI('li-lft-demand-amt', formatNumber(lftDemandAmt));
            setUI('li-lft-fix-amt', formatNumber(lftFixAmt));
            setUI('li-bus-tax-base', importKwh.toLocaleString() + " kWh"); setUI('li-bus-tax-amt', formatNumber(busTaxAmt));
            setUI('li-rpt-base', importKwh.toLocaleString() + " kWh"); setUI('li-rpt-amt', formatNumber(rptAmt));

            setUI('det-vat-total', formatNumber(vatSubtotal));
            setUI('li-gen-vat-base', importKwh.toLocaleString() + " kWh"); setUI('li-gen-vat-amt', formatNumber(genVatAmt));
            setUI('li-trans-vat-base', importKwh.toLocaleString() + " kWh"); setUI('li-trans-vat-amt', formatNumber(transVatAmt));
            setUI('li-sl-vat-base', importKwh.toLocaleString() + " kWh"); setUI('li-sl-vat-amt', formatNumber(slVatAmt));
            setUI('li-dist-vat-kwh-base', importKwh.toLocaleString() + " kWh"); setUI('li-dist-vat-kwh-amt', formatNumber(distVatEnergyAmt));
            setUI('li-dist-vat-fix-amt', formatNumber(distVatFixAmt));
            setUI('li-subs-vat-base', Math.round(actualConsumption).toLocaleString() + " kWh"); setUI('li-subs-vat-amt', formatNumber(subsVatAmt));

            setUI('det-uc-total', formatNumber(ucSubtotal));
            setUI('li-uc-sd-base', importKwh.toLocaleString() + " kWh"); setUI('li-uc-sd-amt', formatNumber(ucSdAmt));
            setUI('li-uc-spug-base', importKwh.toLocaleString() + " kWh"); setUI('li-uc-spug-amt', formatNumber(ucSpugAmt));
            setUI('li-uc-redci-base', importKwh.toLocaleString() + " kWh"); setUI('li-uc-redci-amt', formatNumber(ucRedciAmt));
            setUI('li-uc-env-base', importKwh.toLocaleString() + " kWh"); setUI('li-uc-env-amt', formatNumber(ucEnvAmt));
            setUI('li-fit-base', Math.round(actualConsumption).toLocaleString() + " kWh"); setUI('li-fit-amt', formatNumber(fitAmt));

            setUI('li-export-base', exportKwh.toLocaleString() + " kWh"); setUI('li-export-price', exportPrice.toFixed(4)); setUI('det-der-credit', "- " + formatNumber(derCredit));
            setUI('footer-total', "₱ " + formatNumber(payableAmount));

            // Analytics Panel UI
            setUI('roi-total-capex', "₱ " + formatNumber(derKWp * getR('roi-cost-kw')));
            setUI('roi-monthly-savings', "₱ " + formatNumber(traditionalTotal - payableAmount));
            setUI('roi-payback-val', (traditionalTotal - payableAmount > 0) ? ((derKWp * getR('roi-cost-kw')) / ((traditionalTotal - payableAmount) * 12)).toFixed(1) : "0.0");
            setUI('comp-trad', "₱ " + formatNumber(traditionalTotal)); setUI('comp-trad-util', "₱ " + formatNumber(traditionalTotal));
            setUI('comp-der-exp', "₱ " + formatNumber(payableAmount)); setUI('comp-der-exp-util', "₱ " + formatNumber(payableAmount));

            // Scenario 3: PPA (Non-Exporting)
            const solarPaymentPPA = getR('ppa-rate');
            const gridImportBill = grossTotal; // No credit in non-export
            const ppaTotal = gridImportBill + solarPaymentPPA;

            setUI('comp-der-ppa', "₱ " + formatNumber(ppaTotal));
            setUI('comp-der-ppa-util', "₱ " + formatNumber(gridImportBill));
            setUI('comp-der-ppa-contract', "₱ " + formatNumber(solarPaymentPPA));

            // Smart Ranking Engine
            const scenarios = [
                { id: 'A', name: 'Traditional Grid', cost: traditionalTotal, badge: 'rank-badge-a' },
                { id: 'B', name: 'Net-Metering System', cost: payableAmount, badge: 'rank-badge-b' },
                { id: 'C', name: 'Non-Exporting (PPA)', cost: ppaTotal, badge: 'rank-badge-c' }
            ];

            scenarios.sort((a, b) => a.cost - b.cost);

            scenarios.forEach((s, index) => {
                const rank = index + 1;
                const badgeEl = document.getElementById(s.badge);
                if (badgeEl) {
                    badgeEl.innerText = `RANK #${rank}`;
                    if (rank === 1) {
                        badgeEl.classList.add('ring-4', 'ring-emerald-500/20');
                    } else {
                        badgeEl.classList.remove('ring-4', 'ring-emerald-500/20');
                    }
                }
            });

            const best = scenarios[0];
            const secondBest = scenarios[1];
            const monthlySavingsVsTrad = traditionalTotal - best.cost;

            let resultMsg = "";
            if (best.id === 'A') {
                resultMsg = "Surprisingly, the Traditional Grid is currently the most cost-effective option based on your current rates.";
            } else {
                resultMsg = `The <span class="text-emerald-400">${best.name}</span> is your best financial choice, saving you <span class="text-emerald-400">₱${formatNumber(monthlySavingsVsTrad)}/mo</span> compared to the grid.`;
                if (best.id === 'B' && scenarios[2].id === 'A') {
                    // B is best, A is worst
                }
            }
            document.getElementById('best-scenario-text').innerHTML = resultMsg;
        }

        window.onload = calculateBill;
    </script>
</body>

</html>